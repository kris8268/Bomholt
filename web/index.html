<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Opgaver</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,sans-serif;background:#f0f4f8;padding:16px;max-width:640px;margin:0 auto}
    h1{color:#1F4E79;margin-bottom:16px;font-size:1.4rem}
    .date-group{margin-bottom:24px}
    .date-header{font-size:.85rem;font-weight:bold;color:#666;text-transform:uppercase;
                 letter-spacing:.05em;margin-bottom:8px;padding-bottom:4px;
                 border-bottom:2px solid #2E75B6}
    .card{background:#fff;border-radius:10px;padding:14px 16px;margin-bottom:10px;
          box-shadow:0 1px 4px rgba(0,0,0,.08)}
    .card-addr{font-weight:bold;color:#1F4E79;margin-bottom:8px}
    .block{display:flex;align-items:center;gap:8px;font-size:.9rem;margin-bottom:4px}
    .tag{display:inline-block;padding:2px 8px;border-radius:12px;font-size:.75rem;font-weight:bold}
    .tag-carpenter{background:#FFF3CD;color:#856404}
    .tag-painter{background:#D1ECF1;color:#0C5460}
    .tag-cleaning{background:#D4EDDA;color:#155724}
    .btn{display:inline-block;margin-top:10px;padding:8px 16px;background:#2E75B6;
         color:#fff;border-radius:6px;text-decoration:none;font-size:.9rem}
    .btn:hover{background:#1F4E79}
  </style>
</head>
<body>
  <h1>üìã Kalender</h1>

  {% set ns = namespace(current_date="") %}
  {% for t in tasks %}
    {% set plan_date = t.plan_date %}
    {% if plan_date != ns.current_date %}
      {% if ns.current_date != "" %}</div>{% endif %}
      {% set ns.current_date = plan_date %}
      <div class="date-group">
      <div class="date-header">{{ plan_date }}</div>
    {% endif %}

    <div class="card">
      <div class="card-addr">üìç {{ t.address or "(ukendt adresse)" }}</div>
      {% if t.plan and t.plan.blocks %}
        {% for b in t.plan.blocks %}
          <div class="block">
            <span class="tag tag-{{ b.kind }}">{{ b.label }}</span>
            <span>{{ b.start[11:16] }} ‚Äì {{ b.end[11:16] }}</span>
          </div>
        {% endfor %}
      {% else %}
        <p style="color:#999;font-size:.85rem">Ingen blokke planlagt</p>
      {% endif %}
      <a class="btn" href="/task/{{ t.task_id }}">Se detaljer / meld forsinkelse</a>
    </div>
  {% else %}
    <p style="color:#666;margin-top:32px;text-align:center">Ingen opgaver fundet.</p>
  {% endfor %}
  {% if tasks %}</div>{% endif %}
</body>
</html>
